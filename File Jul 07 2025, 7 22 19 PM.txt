ğŸ¯ Automated Calibration Agent â€“ cncpick2

This document outlines the role and functionality of a future calibration_agent that automates spatial alignment between vision system coordinates and CNC motion workspace.

â¸»

ğŸ“Œ Purpose
	â€¢	Generate 3D mapping between camera space and CNC coordinate space
	â€¢	Simplify field setup and maintenance
	â€¢	Ensure accurate lane and height conversion

â¸»

ğŸ§± Input Requirements

Input Source	Description
Vision Agent	3D camera coordinates (X_cam, Y_cam, Z_cam)
Motion Agent	CNC jogged positions (X_cnc, Y_cnc, Z_cnc)
Lane Mapper Config	Expected lane lines in image space


â¸»

ğŸ” Calibration Workflow
	1.	User jogs CNC to 3â€“5 known landmarks (e.g., corners of belt)
	2.	For each, the system captures the CNC coordinates and camera 3D position
	3.	calibration_agent computes an affine transform matrix (or polynomial fit)
	4.	Matrix is saved to calibration/calib_matrix.json
	5.	vision_agent loads matrix and applies transform on all new detections

â¸»

ğŸ§ª Output Example

{
  "affine_matrix": [
    [1.02, 0.01, 0.0, 5.0],
    [0.0, 0.99, 0.0, -3.0],
    [0.0, 0.0, 1.0, 0.0]
  ],
  "residual_error_mm": 1.2
}


â¸»

âš ï¸ Edge Case Handling
	â€¢	Missing point pair â†’ ignore
	â€¢	Outlier detection using RANSAC or least squares
	â€¢	Min required samples: 3 for affine, 4+ for robust fit

â¸»

ğŸ§  Vision Adjustments
	â€¢	Lane assignment refactored to use CNC-transformed points
	â€¢	Depth-based Z added to pickup planner

â¸»

ğŸ“Œ Summary

The calibration agent enables seamless mapping between camera and CNC domains, providing accuracy and flexibility during setup, and making the system plug-and-play across environments.