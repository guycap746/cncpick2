ğŸ›¡ï¸ Safety Agent Design â€“ cncpick2

This document outlines the future safety_agent, responsible for centralized monitoring, health checks, and emergency halts in both simulation and hardware deployments.

â¸»

ğŸ¯ Purpose
	â€¢	Detect agent failures or anomalies
	â€¢	Monitor GRBL watchdog signals and heartbeat loss
	â€¢	Provide global halt/alert capabilities

â¸»

ğŸ“¥ Inputs
	â€¢	agent_heartbeat events (all agents)
	â€¢	grbl_timeout, grbl_connection_lost
	â€¢	object_missed, pickup_timeout
	â€¢	metric_report (from metrics_agent)

â¸»

âš ï¸ Triggers

Condition	Response
Agent heartbeat missed	Alert + optional restart
Motion timeout	Log + disable CNC motion
Unusual pickup failure rate	Emit warning event
GRBL disconnect	Send global halt


â¸»

ğŸš¨ Global Halt Protocol

When triggered:
	1.	Broadcasts halt_all event

{
  "event": "halt_all",
  "agent": "safety_agent",
  "reason": "grbl lost",
  "timestamp": 1234567890.0
}

	2.	Agents receiving this event must enter a safe pause state:
	â€¢	motion_agent: raise Z, stop queue
	â€¢	scoring_agent: reject assignments
	â€¢	trigger_agent: ignore trigger matches

â¸»

ğŸ“‹ Reporting
	â€¢	Writes summary to logs/safety_report.json
	â€¢	Emits safety_alert events to dashboard

â¸»

ğŸ§ª Simulation Mode
	â€¢	Simulates fault conditions (heartbeat drop, timeout injection)
	â€¢	Enables test coverage of halt propagation logic

â¸»

ğŸ“Œ Summary

The safety_agent offers a centralized fail-safe mechanism for detecting malfunctions, responding to critical errors, and coordinating safe system shutdowns. It supports robust testing and real-world deployments where safety is paramount.