üõ†Ô∏è Hardware Integration Guide ‚Äì cncpick2

This document explains how the cncpick2 system interfaces with real hardware, including GRBL-controlled CNCs, cameras, and the vacuum gripper.

‚∏ª

üß± Hardware Components

1. üß† CNC Machine
	‚Ä¢	Controller: GRBL (e.g., FoxAlien Masuter 3S)
	‚Ä¢	Connected via: USB Serial
	‚Ä¢	Controlled by: grbl_driver_agent
	‚Ä¢	Command Language: G-code

2. üì∑ Depth Camera
	‚Ä¢	Type: OAK-D or similar RGB + Depth camera
	‚Ä¢	Provides:
	‚Ä¢	RGB frame to vision_agent
	‚Ä¢	Depth map for height estimation
	‚Ä¢	Accessed via: Real camera driver OR synthetic image generator in sim mode

3. üß≤ Vacuum Gripper
	‚Ä¢	Controlled by G-code:
	‚Ä¢	M8 = Vacuum ON
	‚Ä¢	M9 = Vacuum OFF
	‚Ä¢	Executed as part of motion G-code macro

‚∏ª

ü§ñ GRBL Driver Agent

File: agents/grbl_driver_agent.py

Responsibilities
	‚Ä¢	Listens for G-code execution commands from motion_agent
	‚Ä¢	Sends G-code via serial to real GRBL device
	‚Ä¢	Waits for ok acknowledgements
	‚Ä¢	In sim mode: fakes delay + sends gcode_ack

Modes

hardware_mode: sim | real

	‚Ä¢	sim: sleeps to simulate motion
	‚Ä¢	real: opens serial port, streams G-code

Required Config

grbl:
  port: "/dev/ttyUSB0"
  baud: 115200
  timeout: 2


‚∏ª

üì∑ Camera Input Switching

In Real Mode
	‚Ä¢	Camera driver delivers:
	‚Ä¢	RGB frames (e.g., via OpenCV or DepthAI)
	‚Ä¢	Depth maps (in mm)

In Sim Mode
	‚Ä¢	Loads synthetic frames or mock objects directly
	‚Ä¢	Emulates vision detection with deterministic output

Vision Agent Logic
	‚Ä¢	Unchanged regardless of input source
	‚Ä¢	Processes RGB + depth and outputs detection event

‚∏ª

üß™ Mode Switching via Config

hardware_mode: sim
camera_input: fake_rgbd
vacuum_control: gcode_m8_m9

	‚Ä¢	Used by motion, driver, and vision agents
	‚Ä¢	Ensures the same logic runs in test and real modes

‚∏ª

‚ö†Ô∏è Safety Notes
	‚Ä¢	Vacuum ON (M8) must only run after Z-lowering
	‚Ä¢	Ensure machine is homed before first move
	‚Ä¢	Add emergency stop capability in real setup
	‚Ä¢	Do not run simulated G-code on a live machine without review

‚∏ª

üõ†Ô∏è Deployment Checklist

Component	Sim Mode	Real Mode
grbl_driver	Delay + mock	Serial over USB
Camera input	Static frames	DepthAI/OpenCV feed
Vacuum control	G-code mocked	M8/M9 real output


‚∏ª

This integration guide ensures cncpick2 runs identically in simulated and real-world deployments with minimal reconfiguration.