ğŸ”„ Detailed Logic Map â€“ cncpick2

This document outlines the complete step-by-step logical flow for a single object lifecycle in the system, covering all agent interactions, responsibilities, and communication patterns.

â¸»

ğŸ¬ 1. Object Enters the System

Agent: simulator_agent
	â€¢	Spawns a new object in the simulation at a given time, lane, and position.
	â€¢	Publishes object_spawned event.

{
  "event": "object_spawned",
  "object_id": "uuid1234",
  "lane": 2,
  "timestamp": "...",
  "agent": "simulator_agent"
}


â¸»

ğŸ¯ 2. Object Is Detected by Vision

Agent: vision_agent
	â€¢	Simulates YOLO detection of object (green object detection).
	â€¢	Calculates object area, lane from pixel coordinates, and Z height from depth map.
	â€¢	Publishes object_detected event.

{
  "event": "object_detected",
  "object_id": "uuid1234",
  "class": "green_target",
  "lane": 2,
  "height_mm": 31.5,
  "area_px": 3088,
  "agent": "vision_agent"
}


â¸»

ğŸ“‹ 3. Object Is Assigned to a CNC Picker

Agent: scoring_agent
	â€¢	Maintains a queue of detected objects.
	â€¢	When a motion agent becomes available, assigns an object.
	â€¢	Publishes object_assigned event.

{
  "event": "object_assigned",
  "object_id": "uuid1234",
  "assigned_to": "motion_agent_1",
  "agent": "scoring_agent"
}


â¸»

ğŸ“¬ 4. Motion Agent Moves to Lane & Requests Trigger

Agent: motion_agent_1
	â€¢	Receives assignment from scoring_agent.
	â€¢	Moves to correct pickup lane via G-code.
	â€¢	Submits request to trigger_agent_1 to watch for correct object.
	â€¢	Enters WAIT state until trigger signal.

â¸»

ğŸ‘ï¸ 5. Object Reaches Pickup Zone

Agent: trigger_agent_1
	â€¢	Continuously watches RGB stream for matching object (lane + area).
	â€¢	When object matches, publishes object_ready_for_pickup event.

{
  "event": "object_ready_for_pickup",
  "object_id": "uuid1234",
  "lane": 2,
  "agent": "trigger_agent_1"
}


â¸»

ğŸ¤– 6. Motion Agent Executes Pickup Routine

Agent: motion_agent_1
	â€¢	On trigger, sends G-code to grbl_driver_agent:
	â€¢	Move in sync with conveyor
	â€¢	Lower Z using provided height
	â€¢	Turn on vacuum (M8) at correct time
	â€¢	Lift object and move to drop zone
	â€¢	Publishes object_picked event

{
  "event": "object_picked",
  "object_id": "uuid1234",
  "agent": "motion_agent_1"
}


â¸»

ğŸ“¦ 7. Object Is Dropped in Bin

Agent: motion_agent_1
	â€¢	Moves to virtual drop location
	â€¢	Turns vacuum off (M9) to release
	â€¢	Publishes object_dropped event
	â€¢	Moves to central ready position
	â€¢	Publishes motion_agent_ready to scoring_agent

{
  "event": "object_dropped",
  "object_id": "uuid1234",
  "drop_location": "bin_1",
  "agent": "motion_agent_1"
}


â¸»

ğŸ“‰ 8. Post-Pick Monitoring (Passive)

Agent: post_pick_monitor_agent
	â€¢	Tracks objects that pass beyond pickup zone
	â€¢	Publishes object_missed if a previously-assigned object is seen after expected pickup
	â€¢	Tracks YOLO vs. ground-truth vision discrepancy

â¸»

ğŸ§¾ 9. Logging

Agent: data_logging_agent
	â€¢	SUB socket listens to all agent PUB messages
	â€¢	Writes structured log entries to disk (JSONL + SQLite)
	â€¢	Used by:
	â€¢	test_runner.py
	â€¢	post_pick_monitor_agent
	â€¢	Future metrics agent

â¸»

ğŸ§  10. Next Cycle Begins
	â€¢	scoring_agent is notified that motion_agent_1 is available
	â€¢	Next unassigned object is given for pickup
	â€¢	New object spawns into the system

â¸»

âœ… End-to-End Flow Complete

This logic map ensures:
	â€¢	Each agent performs its intended role
	â€¢	No shortcut logic is used
	â€¢	Sim mirrors real-world messaging
	â€¢	Failures and diagnostics are traceable

We can now derive message schemas and agent-specific docs from this foundation.